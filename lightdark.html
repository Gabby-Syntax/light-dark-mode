<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fancy Theme Toggle</title>
  <meta name="color-scheme" content="light dark" />
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />
  <style>
    :root {
      --bg: #0e0f1a;
      --fg: #e8eaf1;
    }

    :root[data-theme="light"] {
      --bg: #f7f9fc;
      --fg: #101319;
    }

    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: var(--fg);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: background-color .4s ease, color .4s ease;
    }

    .switch {
      --h: 50px; --w: 100px; --pad: 5px;
      position: relative; width: var(--w); height: var(--h);
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(255,255,255,.2), rgba(0,0,0,.05));
      border: 1px solid rgba(255,255,255,.2);
      box-shadow: inset 0 2px 6px rgba(0,0,0,.15), 0 8px 20px rgba(0,0,0,.25);
      cursor: pointer;
      display: inline-flex; align-items: center; padding: var(--pad);
      transition: transform .12s ease;
    }
    .switch:active { transform: scale(.97); }
    .knob {
      position: absolute; top: var(--pad); left: var(--pad);
      width: calc(var(--h) - var(--pad)*2); height: calc(var(--h) - var(--pad)*2);
      border-radius: 50%;
      background: linear-gradient(180deg, #fff, #dfe7ff);
      box-shadow: 0 8px 20px rgba(0,0,0,.35);
      transition: left .25s ease, background .25s ease;
      display: grid; place-items: center;
      color: #111;
    }
    .switch[aria-checked="true"] .knob {
      left: calc(var(--w) - var(--h) + var(--pad));
      background: linear-gradient(180deg, #16181f, #0f1117);
      color: #fff;
    }

    .icons {
      position: absolute; inset: 0; display: flex; align-items: center; justify-content: space-between; padding: 0 14px;
      color: var(--fg); font-size: 20px;
    }
  </style>
</head>
<body>
  <button id="themeSwitch" class="switch" role="switch" aria-checked="false" aria-label="Toggle dark mode">
    <span class="icons" aria-hidden="true">
      <!-- Sun -->
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2m16 0h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/></svg>
      <!-- Moon -->
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
    </span>
    <span class="knob"></span>
  </button>

  <script>
    (function() {
      const STORAGE_KEY = 'theme-preference';
      const root = document.documentElement;
      const switchEl = document.getElementById('themeSwitch');

      function setTheme(mode) {
        root.setAttribute('data-theme', mode);
        switchEl.setAttribute('aria-checked', String(mode === 'dark'));
        try { localStorage.setItem(STORAGE_KEY, mode); } catch(_) {}
      }

      function getSavedTheme() {
        try { return localStorage.getItem(STORAGE_KEY) || 'light'; } catch(_) { return 'light'; }
      }

      function toggleTheme() {
        const current = root.getAttribute('data-theme') || 'light';
        setTheme(current === 'dark' ? 'light' : 'dark');
      }

      setTheme(getSavedTheme());

      switchEl.addEventListener('click', toggleTheme);
      switchEl.addEventListener('keydown', (e) => {
        if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); toggleTheme(); }
      });
    })();
  </script>
</body>
</html>
